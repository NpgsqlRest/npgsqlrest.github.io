import{_ as a,c as i,o as e,a5 as n}from"./chunks/framework.CgT1UzWm.js";const u=JSON.parse('{"title":"COMMAND_TIMEOUT Annotation","titleTemplate":"NpgsqlRest","description":"Set query execution timeout for PostgreSQL REST API endpoints. Configure per-endpoint database command timeouts.","frontmatter":{"outline":[2,3],"title":"COMMAND_TIMEOUT Annotation","titleTemplate":"NpgsqlRest","description":"Set query execution timeout for PostgreSQL REST API endpoints. Configure per-endpoint database command timeouts.","head":[["meta",{"name":"keywords","content":"npgsqlrest timeout, query timeout, command timeout, postgresql timeout, api request timeout"}],["meta",{"property":"og:title","content":"NpgsqlRest COMMAND_TIMEOUT Annotation"}],["meta",{"property":"og:description","content":"Set query execution timeout for individual PostgreSQL REST API endpoints."}],["meta",{"property":"og:type","content":"article"}]]},"headers":[],"relativePath":"annotations/command-timeout.md","filePath":"annotations/command-timeout.md"}'),t={name:"annotations/command-timeout.md"};function l(o,s,r,p,d,h){return e(),i("div",null,s[0]||(s[0]=[n(`<h1 id="command-timeout" tabindex="-1">COMMAND_TIMEOUT <a class="header-anchor" href="#command-timeout" aria-label="Permalink to &quot;COMMAND_TIMEOUT&quot;">​</a></h1><div class="info custom-block"><p class="custom-block-title">Also known as</p><p><code>timeout</code> (with or without <code>@</code> prefix)</p></div><p>Set the query execution timeout for the endpoint.</p><h2 id="syntax" tabindex="-1">Syntax <a class="header-anchor" href="#syntax" aria-label="Permalink to &quot;Syntax&quot;">​</a></h2><details class="code-collapsible" open><summary>code</summary><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@timeout &lt;interval&gt;</span></span>
<span class="line"><span>@command_timeout &lt;interval&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details><p>Or using custom parameter syntax:</p><details class="code-collapsible" open><summary>code</summary><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@timeout = &lt;interval&gt;</span></span>
<span class="line"><span>@command_timeout = &lt;interval&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details><p>The value uses the <a href="./interval-format.html">interval format</a>. Common examples:</p><div class="table-container"><div class="table-wrapper"><table tabindex="0"><thead><tr><th>Unit</th><th>Examples</th></tr></thead><tbody><tr><td>Microseconds</td><td><code>1000us</code>, <code>1000usec</code>, <code>1000microseconds</code></td></tr><tr><td>Milliseconds</td><td><code>500ms</code>, <code>500msec</code>, <code>500milliseconds</code></td></tr><tr><td>Seconds</td><td><code>30</code>, <code>30s</code>, <code>30sec</code>, <code>30seconds</code></td></tr><tr><td>Minutes</td><td><code>5m</code>, <code>5min</code>, <code>5minutes</code></td></tr><tr><td>Hours</td><td><code>1h</code>, <code>1hour</code>, <code>1hours</code></td></tr><tr><td>Days</td><td><code>1d</code>, <code>1day</code>, <code>1days</code></td></tr><tr><td>Weeks</td><td><code>1w</code>, <code>1week</code>, <code>1weeks</code></td></tr></tbody></table></div></div><div class="warning custom-block"><p class="custom-block-title">Single Token Requirement</p><p>The <code>@timeout</code> annotation reads only the <strong>first token</strong> after the keyword. Use formats without spaces to avoid parsing issues. Numbers without a unit default to seconds.</p></div><h2 id="default-value" tabindex="-1">Default Value <a class="header-anchor" href="#default-value" aria-label="Permalink to &quot;Default Value&quot;">​</a></h2><p>The default timeout is configured via <code>NpgsqlRest.CommandTimeout</code> in configuration. If not set, defaults to 30 seconds.</p><h2 id="examples" tabindex="-1">Examples <a class="header-anchor" href="#examples" aria-label="Permalink to &quot;Examples&quot;">​</a></h2><h3 id="short-timeout" tabindex="-1">Short Timeout <a class="header-anchor" href="#short-timeout" aria-label="Permalink to &quot;Short Timeout&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> quick_lookup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">returns</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> json</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">language</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sql</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> atomic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> row_to_json(t) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _id;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function quick_lookup(int) is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP GET</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@timeout 5s&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></details><h3 id="long-running-query" tabindex="-1">Long Running Query <a class="header-anchor" href="#long-running-query" aria-label="Permalink to &quot;Long Running Query&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generate_report</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_year </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">returns</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> json</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">language</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> sql</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> atomic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...complex aggregation...;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function generate_report(int) is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP GET</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@timeout 2min</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@authorize&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></details><h3 id="using-seconds-format" tabindex="-1">Using Seconds Format <a class="header-anchor" href="#using-seconds-format" aria-label="Permalink to &quot;Using Seconds Format&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function slow_process() is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@command_timeout 90s&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></details><h2 id="behavior" tabindex="-1">Behavior <a class="header-anchor" href="#behavior" aria-label="Permalink to &quot;Behavior&quot;">​</a></h2><ul><li>Overrides the global <code>NpgsqlRest.CommandTimeout</code> configuration for this endpoint.</li><li>Query is cancelled if it exceeds the timeout.</li><li>On timeout, returns the response configured in <code>ErrorHandlingOptions.TimeoutErrorMapping</code>.</li></ul><h2 id="timeout-response" tabindex="-1">Timeout Response <a class="header-anchor" href="#timeout-response" aria-label="Permalink to &quot;Timeout Response&quot;">​</a></h2><p>When a command times out, the response is determined by the <code>TimeoutErrorMapping</code> configuration:</p><details class="code-collapsible" open><summary>json</summary><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;ErrorHandlingOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;TimeoutErrorMapping&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;StatusCode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">504</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;Title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Command execution timed out&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;Details&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      &quot;Type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></details><p>Default timeout response: <strong>HTTP 504 Gateway Timeout</strong></p><p>See <a href="./../config/error-handling.html">Error Handling</a> for customizing timeout responses.</p><h2 id="related" tabindex="-1">Related <a class="header-anchor" href="#related" aria-label="Permalink to &quot;Related&quot;">​</a></h2><ul><li><a href="./interval-format.html">Interval Format</a> - Complete interval format reference</li><li><a href="./../config/npgsqlrest.html">NpgsqlRest Options configuration</a> - Set global <code>CommandTimeout</code> default</li><li><a href="./../config/error-handling.html">Error Handling configuration</a> - Configure <code>TimeoutErrorMapping</code> response</li><li><a href="./../guide/annotations.html">Comment Annotations Guide</a> - How annotations work</li><li><a href="./../guide/configuration.html">Configuration Guide</a> - How configuration works</li></ul><h2 id="related-annotations" tabindex="-1">Related Annotations <a class="header-anchor" href="#related-annotations" aria-label="Permalink to &quot;Related Annotations&quot;">​</a></h2><ul><li><a href="./buffer-rows.html">BUFFER_ROWS</a> - Control row buffering</li><li><a href="./retry-strategy.html">RETRY_STRATEGY</a> - Retry on failure</li></ul>`,30)]))}const k=a(t,[["render",l]]);export{u as __pageData,k as default};
