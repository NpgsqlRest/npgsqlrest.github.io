import{_ as e,c as a,o as n,a5 as i}from"./chunks/framework.CgT1UzWm.js";const u=JSON.parse('{"title":"SSE_EVENTS_SCOPE Annotation","titleTemplate":"NpgsqlRest","description":"Control Server-Sent Events broadcast scope. Configure SSE message delivery to individual connections or all listeners.","frontmatter":{"outline":[2,3],"title":"SSE_EVENTS_SCOPE Annotation","titleTemplate":"NpgsqlRest","description":"Control Server-Sent Events broadcast scope. Configure SSE message delivery to individual connections or all listeners.","head":[["meta",{"name":"keywords","content":"npgsqlrest sse scope, server sent events broadcast, sse message scope, event broadcasting, real-time scope"}],["meta",{"property":"og:title","content":"NpgsqlRest SSE_EVENTS_SCOPE Annotation"}],["meta",{"property":"og:description","content":"Control Server-Sent Events broadcast scope for message delivery."}],["meta",{"property":"og:type","content":"article"}]]},"headers":[],"relativePath":"annotations/sse-events-scope.md","filePath":"annotations/sse-events-scope.md"}'),t={name:"annotations/sse-events-scope.md"};function l(p,s,r,o,h,c){return n(),a("div",null,s[0]||(s[0]=[i(`<h1 id="sse-events-scope" tabindex="-1">SSE_EVENTS_SCOPE <a class="header-anchor" href="#sse-events-scope" aria-label="Permalink to &quot;SSE_EVENTS_SCOPE&quot;">​</a></h1><div class="info custom-block"><p class="custom-block-title">Also known as</p><p><code>sse_scope</code> (with or without <code>@</code> prefix)</p></div><p>Control who receives Server-Sent Events from this endpoint.</p><h2 id="syntax" tabindex="-1">Syntax <a class="header-anchor" href="#syntax" aria-label="Permalink to &quot;Syntax&quot;">​</a></h2><details class="code-collapsible" open><summary>code</summary><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@sse_scope &lt;scope&gt;</span></span>
<span class="line"><span>@sse_scope authorize &lt;value1&gt;, &lt;value2&gt;, ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details><p>Space-separated lists are also valid: <code>@sse_scope authorize admin manager supervisor</code></p><p>Or using custom parameter syntax:</p><details class="code-collapsible" open><summary>code</summary><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@sse_scope = &lt;scope&gt;</span></span>
<span class="line"><span>@sse_events_scope = &lt;scope&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></details><h2 id="values" tabindex="-1">Values <a class="header-anchor" href="#values" aria-label="Permalink to &quot;Values&quot;">​</a></h2><div class="table-container"><div class="table-wrapper"><table tabindex="0"><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>matching</code></td><td>Clients with matching security context receive events</td></tr><tr><td><code>authorize</code></td><td>Only authorized clients receive events. Optionally filter by role names, user names, or user IDs</td></tr><tr><td><code>all</code></td><td>All connected clients receive events</td></tr></tbody></table></div></div><h2 id="request-correlation" tabindex="-1">Request Correlation <a class="header-anchor" href="#request-correlation" aria-label="Permalink to &quot;Request Correlation&quot;">​</a></h2><p>Events are filtered by execution ID when both conditions are met:</p><ul><li>The request includes an execution ID header (configured via <code>ExecutionIdHeaderName</code>)</li><li>The SSE event source includes the same execution ID as a query parameter</li></ul><p>When execution IDs are provided but don&#39;t match, the event is skipped regardless of scope.</p><h2 id="examples" tabindex="-1">Examples <a class="header-anchor" href="#examples" aria-label="Permalink to &quot;Examples&quot;">​</a></h2><h3 id="matching-scope" tabindex="-1">Matching Scope <a class="header-anchor" href="#matching-scope" aria-label="Permalink to &quot;Matching Scope&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function team_task() is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse /team-events</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse_scope matching&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></details><p>Events are sent to clients with matching security context:</p><ul><li>If the endpoint requires authorization, all authorized sessions receive events</li><li>If the endpoint requires specific roles, only sessions with those roles receive events</li></ul><h3 id="authorize-scope-with-roles" tabindex="-1">Authorize Scope with Roles <a class="header-anchor" href="#authorize-scope-with-roles" aria-label="Permalink to &quot;Authorize Scope with Roles&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function admin_broadcast() is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse /admin-events</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse_scope authorize admin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></details><p>Only clients with <code>admin</code> role receive events.</p><h3 id="authorize-with-user-names-or-ids" tabindex="-1">Authorize with User Names or IDs <a class="header-anchor" href="#authorize-with-user-names-or-ids" aria-label="Permalink to &quot;Authorize with User Names or IDs&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function specific_users_notification() is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse /user-events</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse_scope authorize john.doe, jane.smith, user123&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></details><p>Events are sent to clients matching any of the specified role names, user names, or user IDs.</p><h3 id="multiple-values" tabindex="-1">Multiple Values <a class="header-anchor" href="#multiple-values" aria-label="Permalink to &quot;Multiple Values&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function staff_notification() is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse /staff-events</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse_scope authorize admin, manager, supervisor&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></details><p>Clients matching any of the specified values receive events.</p><h3 id="broadcast-to-all" tabindex="-1">Broadcast to All <a class="header-anchor" href="#broadcast-to-all" aria-label="Permalink to &quot;Broadcast to All&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function system_announcement() is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse /announcements</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse_scope all&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></details><p>All connected SSE clients receive events regardless of security context.</p><h2 id="dynamic-scope-via-raise-hint" tabindex="-1">Dynamic Scope via RAISE HINT <a class="header-anchor" href="#dynamic-scope-via-raise-hint" aria-label="Permalink to &quot;Dynamic Scope via RAISE HINT&quot;">​</a></h2><p>The scope can also be set dynamically at runtime using the <code>HINT</code> parameter of PostgreSQL <code>RAISE</code> statements. This allows different events within the same function to have different scopes:</p><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> process_with_notifications</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> void</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">language</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plpgsql</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $$</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- This event goes to all clients</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  raise notice </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;System maintenance starting...&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hint </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;all&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- This event only goes to admins</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  raise notice </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Admin: detailed system stats...&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hint </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;authorize admin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- This event goes to specific users</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  raise notice </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Your task is complete&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hint </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;authorize john.doe, jane.smith&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- This event uses the default scope from annotation</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  raise notice </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;General progress update...&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$$;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function process_with_notifications() is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse /process-events</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse_scope matching&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></details><p>The <code>HINT</code> value is parsed as: <code>&lt;scope&gt; [value1] [value2] ...</code></p><p>When a hint is provided, it overrides the annotation scope for that specific event. When no hint is provided, the annotation scope is used.</p><h2 id="related" tabindex="-1">Related <a class="header-anchor" href="#related" aria-label="Permalink to &quot;Related&quot;">​</a></h2><ul><li><a href="./../config/npgsqlrest.html">NpgsqlRest Options configuration</a> - Configure SSE options</li><li><a href="./../guide/annotations.html">Comment Annotations Guide</a> - How annotations work</li><li><a href="./../guide/configuration.html">Configuration Guide</a> - How configuration works</li></ul><h2 id="related-annotations" tabindex="-1">Related Annotations <a class="header-anchor" href="#related-annotations" aria-label="Permalink to &quot;Related Annotations&quot;">​</a></h2><ul><li><a href="./sse.html">SSE</a> - Enable Server-Sent Events</li><li><a href="./sse-events-level.html">SSE_EVENTS_LEVEL</a> - Set notice level</li><li><a href="./authorize.html">AUTHORIZE</a> - Endpoint authorization</li></ul>`,40)]))}const k=e(t,[["render",l]]);export{u as __pageData,k as default};
