import{_ as s,c as a,o as n,a5 as t}from"./chunks/framework.CgT1UzWm.js";const u=JSON.parse('{"title":"SSE Annotation","titleTemplate":"NpgsqlRest","description":"Enable Server-Sent Events streaming for PostgreSQL REST APIs. Create real-time endpoints with SSE for live data updates.","frontmatter":{"outline":[2,3],"title":"SSE Annotation","titleTemplate":"NpgsqlRest","description":"Enable Server-Sent Events streaming for PostgreSQL REST APIs. Create real-time endpoints with SSE for live data updates.","head":[["meta",{"name":"keywords","content":"npgsqlrest sse, server sent events, real-time api, streaming endpoint, postgresql streaming, live updates"}],["meta",{"property":"og:title","content":"NpgsqlRest SSE Annotation"}],["meta",{"property":"og:description","content":"Enable Server-Sent Events streaming for real-time data updates from PostgreSQL."}],["meta",{"property":"og:type","content":"article"}]]},"headers":[],"relativePath":"annotations/sse.md","filePath":"annotations/sse.md"}'),i={name:"annotations/sse.md"};function l(o,e,p,r,d,c){return n(),a("div",null,e[0]||(e[0]=[t(`<h1 id="sse" tabindex="-1">SSE <a class="header-anchor" href="#sse" aria-label="Permalink to &quot;SSE&quot;">​</a></h1><div class="info custom-block"><p class="custom-block-title">Also known as</p><p><code>sse_events_path</code>, <code>sse_path</code> (with or without <code>@</code> prefix)</p></div><p>Enable Server-Sent Events (SSE) streaming for the endpoint.</p><h2 id="syntax" tabindex="-1">Syntax <a class="header-anchor" href="#syntax" aria-label="Permalink to &quot;Syntax&quot;">​</a></h2><details class="code-collapsible" open><summary>code</summary><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@sse</span></span>
<span class="line"><span>@sse &lt;path&gt;</span></span>
<span class="line"><span>@sse &lt;path&gt; on &lt;level&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></details><p><strong>level</strong>: <code>info</code>, <code>notice</code>, <code>warning</code></p><h2 id="sse-path-construction" tabindex="-1">SSE Path Construction <a class="header-anchor" href="#sse-path-construction" aria-label="Permalink to &quot;SSE Path Construction&quot;">​</a></h2><p>The SSE endpoint path is constructed by <strong>appending</strong> the SSE path segment to the <strong>original endpoint path</strong>.</p><h3 id="when-path-is-omitted" tabindex="-1">When Path is Omitted <a class="header-anchor" href="#when-path-is-omitted" aria-label="Permalink to &quot;When Path is Omitted&quot;">​</a></h3><p>When the path is omitted (<code>@sse</code> without arguments), the SSE path segment defaults to the <strong>notice level name in lowercase</strong>:</p><div class="table-container"><div class="table-wrapper"><table tabindex="0"><thead><tr><th>Level</th><th>SSE Path Segment</th></tr></thead><tbody><tr><td><code>INFO</code> (default)</td><td><code>info</code></td></tr><tr><td><code>NOTICE</code></td><td><code>notice</code></td></tr><tr><td><code>WARNING</code></td><td><code>warning</code></td></tr></tbody></table></div></div><p><strong>Example:</strong> If your endpoint path is <code>/api/my-function</code> and you use <code>@sse</code> without arguments, the SSE endpoint will be at <code>/api/my-function/info</code> (since <code>INFO</code> is the default level).</p><h3 id="when-custom-path-is-specified" tabindex="-1">When Custom Path is Specified <a class="header-anchor" href="#when-custom-path-is-specified" aria-label="Permalink to &quot;When Custom Path is Specified&quot;">​</a></h3><p>When you specify a custom path (<code>@sse my_events</code>), that path segment is appended to the endpoint path.</p><p><strong>Example:</strong> If your endpoint path is <code>/api/my-function</code> and you use <code>@sse my_events</code>, the SSE endpoint will be at <code>/api/my-function/my_events</code>.</p><h2 id="default-level" tabindex="-1">Default Level <a class="header-anchor" href="#default-level" aria-label="Permalink to &quot;Default Level&quot;">​</a></h2><p>The default notice level is <strong><code>INFO</code></strong>. This can be changed globally via the <a href="./../config/npgsqlrest.html#server-sent-events"><code>DefaultServerSentEventsEventNoticeLevel</code></a> configuration setting.</p><h2 id="level-filtering" tabindex="-1">Level Filtering <a class="header-anchor" href="#level-filtering" aria-label="Permalink to &quot;Level Filtering&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">Important</p><p>SSE events are sent <strong>only for the exact level specified</strong>, not for &quot;this level and above&quot;.</p></div><p>When you set the level to <code>NOTICE</code>, only <code>RAISE NOTICE</code> statements will generate SSE events. <code>RAISE INFO</code> and <code>RAISE WARNING</code> statements will <strong>not</strong> generate SSE events for that endpoint.</p><div class="table-container"><div class="table-wrapper"><table tabindex="0"><thead><tr><th>Configured Level</th><th><code>RAISE INFO</code></th><th><code>RAISE NOTICE</code></th><th><code>RAISE WARNING</code></th></tr></thead><tbody><tr><td><code>INFO</code></td><td>Sent</td><td>Not sent</td><td>Not sent</td></tr><tr><td><code>NOTICE</code></td><td>Not sent</td><td>Sent</td><td>Not sent</td></tr><tr><td><code>WARNING</code></td><td>Not sent</td><td>Not sent</td><td>Sent</td></tr></tbody></table></div></div><p>If you need events from multiple levels, create separate SSE endpoints for each level.</p><h2 id="examples" tabindex="-1">Examples <a class="header-anchor" href="#examples" aria-label="Permalink to &quot;Examples&quot;">​</a></h2><h3 id="basic-sse-endpoint" tabindex="-1">Basic SSE Endpoint <a class="header-anchor" href="#basic-sse-endpoint" aria-label="Permalink to &quot;Basic SSE Endpoint&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> long_running_process</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">returns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> void</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">language</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> plpgsql</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $$</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  raise info </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Starting process...&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- do work</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  raise info </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Progress: 50%%&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- more work</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  raise info </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Complete!&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$$;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function long_running_process(int) is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse events&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></details><p>If the endpoint is at <code>/api/long-running-process</code>, the SSE endpoint will be at <code>/api/long-running-process/events</code>. It receives <code>RAISE INFO</code> messages (the default level).</p><h3 id="with-notice-level" tabindex="-1">With Notice Level <a class="header-anchor" href="#with-notice-level" aria-label="Permalink to &quot;With Notice Level&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function background_task() is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse updates on notice&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></details><p>If the endpoint is at <code>/api/background-task</code>, the SSE endpoint will be at <code>/api/background-task/updates</code>. It receives <strong>only</strong> <code>RAISE NOTICE</code> messages.</p><h3 id="warning-level-only" tabindex="-1">Warning Level Only <a class="header-anchor" href="#warning-level-only" aria-label="Permalink to &quot;Warning Level Only&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function critical_job() is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse alerts on warning&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></details><p>If the endpoint is at <code>/api/critical-job</code>, the SSE endpoint will be at <code>/api/critical-job/alerts</code>. It receives <strong>only</strong> <code>RAISE WARNING</code> messages.</p><h3 id="using-default-path-level-name" tabindex="-1">Using Default Path (Level Name) <a class="header-anchor" href="#using-default-path-level-name" aria-label="Permalink to &quot;Using Default Path (Level Name)&quot;">​</a></h3><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function my_process() is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></details><p>If the endpoint is at <code>/api/my-process</code>, the SSE endpoint will be at <code>/api/my-process/info</code> (default path segment from the default <code>INFO</code> level).</p><details class="code-collapsible" open><summary>sql</summary><div class="language-sql vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">comment on function my_process() is</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;HTTP POST</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse_events_level notice</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">@sse&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></details><p>If the endpoint is at <code>/api/my-process</code>, the SSE endpoint will be at <code>/api/my-process/notice</code> (path segment derived from the configured <code>NOTICE</code> level).</p><h2 id="behavior" tabindex="-1">Behavior <a class="header-anchor" href="#behavior" aria-label="Permalink to &quot;Behavior&quot;">​</a></h2><ul><li>Creates an SSE endpoint by appending the path segment to the original endpoint path</li><li>PostgreSQL <code>RAISE</code> statements become SSE events</li><li>Only statements matching the <strong>exact configured level</strong> generate events</li><li>Clients connect to SSE path to receive real-time updates</li><li>Use the <code>X-NpgsqlRest-ID</code> header to correlate SSE events to specific requests</li></ul><h2 id="related" tabindex="-1">Related <a class="header-anchor" href="#related" aria-label="Permalink to &quot;Related&quot;">​</a></h2><ul><li><a href="./../config/npgsqlrest.html">NpgsqlRest Options configuration</a> - Configure SSE options</li><li><a href="./../guide/annotations.html">Comment Annotations Guide</a> - How annotations work</li><li><a href="./../guide/configuration.html">Configuration Guide</a> - How configuration works</li></ul><h2 id="related-annotations" tabindex="-1">Related Annotations <a class="header-anchor" href="#related-annotations" aria-label="Permalink to &quot;Related Annotations&quot;">​</a></h2><ul><li><a href="./sse-events-level.html">SSE_EVENTS_LEVEL</a> - Set notice level</li><li><a href="./sse-events-scope.html">SSE_EVENTS_SCOPE</a> - Set distribution scope</li></ul>`,43)]))}const m=s(i,[["render",l]]);export{u as __pageData,m as default};
